
<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>PostiDZ - Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap');
    body {
      font-family: 'Cairo', sans-serif;
      direction: rtl;
      background: linear-gradient(to bottom, #a8edea, #fed6e3);
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #ffffffee;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      border: 2px solid #56cfe1;
    }
    h2 {
      text-align: center;
      color: #168aad;
    }
    input, select, button {
      padding: 12px;
      font-size: 16px;
      margin: 10px 0;
      border-radius: 10px;
      border: 1px solid #ccc;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      background-color: #ff9770;
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #ff6b6b;
    }
    #searchBox {
      background-image: url('https://cdn-icons-png.flaticon.com/512/622/622669.png');
      background-size: 20px 20px;
      background-repeat: no-repeat;
      background-position: 10px center;
      padding-right: 40px;
    }
    .result-card {
      background: #e3fafc;
      padding: 10px;
      margin: 10px 0;
      border-radius: 10px;
      border: 1px solid #ade8f4;
    }
  </style>
</head>
<body>

<!-- Ø´Ø±ÙŠØ· Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ²Ø¹ ÙˆØ²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ -->
<div style="display: flex; justify-content: space-between; align-items: center; background: #d9f9ff; padding: 10px 20px; border-radius: 10px; margin-bottom: 20px;">
  <div id="agentName" style="color: #168aad; font-weight: bold;">ğŸ‘¤ Ù…ÙˆØ²Ø¹: ...</div>
  <button onclick="logout()" style="background-color: #ff6b6b; color: white; border: none; border-radius: 8px; padding: 10px; cursor: pointer;">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
</div>

<div class="container">
  <h2>ğŸ“¦ ØªØ³Ø¬ÙŠÙ„ ÙˆØªØ³Ù„ÙŠÙ… Ø§Ù„Ø²Ø¨ÙˆÙ†</h2>

  <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù…">
  <input type="text" id="surname" placeholder="Ø§Ù„Ù„Ù‚Ø¨">
  <input type="text" id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„">
  <input type="text" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05 Ø£Ùˆ 06 Ø£Ùˆ 07)">
  <input type="text" id="tracking" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹" oninput="processTracking()">

  <select id="messageType">
    <option value="">-- Ù†ÙˆØ¹ Ø§Ù„Ø·Ø±Ø¯ --</option>
    <option value="ØµÙƒ Ø¨Ø±ÙŠØ¯ÙŠ">ğŸ’° ØµÙƒ Ø¨Ø±ÙŠØ¯ÙŠ</option>
    <option value="Ø±Ø³Ø§Ù„Ø©">ğŸ“® Ø±Ø³Ø§Ù„Ø©</option>
    <option value="Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø±Ø¬">ğŸŒ Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø±Ø¬</option>
    <option value="ØªÙ„ØºØ±Ø§Ù…">ğŸ“¨ ØªÙ„ØºØ±Ø§Ù…</option>
  </select>

  <label for="idImage">ğŸ“· ØµÙˆØ±Ø© Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‡ÙˆÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
  <input type="file" id="idImage" accept="image/*">

  <select id="deliveryStatus">
    <option value="ØºÙŠØ± Ù…Ø³Ù„Ù…">-- Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ… --</option>
    <option value="ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…">âœ… ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</option>
    <option value="ØªØ¨Ù„ÙŠØº Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„ÙˆØµÙˆÙ„">ğŸ“© Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„ÙˆØµÙˆÙ„</option>
    <option value="Ø±ÙØ¶">âŒ Ù…Ø±ÙÙˆØ¶</option>
    <option value="DECEDE">â˜ ï¸ Ù…ØªÙˆÙÙŠ</option>
    <option value="NHPAI">ğŸ  Ø¹Ù†ÙˆØ§Ù† ØºÙŠØ± Ù…Ø°ÙƒÙˆØ±</option>
    <option value="PSA">ğŸ“¦ Ø§Ù†ØªÙ‚Ù„ Ù…Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</option>
    <option value="A IMOMPLETE">ğŸ“„ Ø¹Ù†ÙˆØ§Ù† Ù†Ø§Ù‚Øµ</option>
    <option value="BF">ğŸšª Ø¨Ø§Ø¨ Ù…ØºÙ„Ù‚</option>
    <option value="RF">ğŸš§ Ø·Ø±ÙŠÙ‚ Ù…ØºÙ„Ù‚</option>
    <option value="PI">â“ Ø´Ø®Øµ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ</option>
  </select>

  <button onclick="saveClient()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø²Ø¨ÙˆÙ†</button>
  <button onclick="downloadExcel()">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† Excel</button>

  <hr>

  <input type="text" id="searchBox" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù„Ù‚Ø¨ Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹">
  <button onclick="searchClients()">ğŸ” ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø«</button>
  <button onclick="downloadSearchExcel()">ğŸ“¤ ØªØ­Ù…ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Excel</button>

  <div id="results"></div>
</div>

<script>
  const clients = [];
  let searchResults = [];

  window.onload = function () {
    const saved = localStorage.getItem("posti_clients");
    if (saved) clients.push(...JSON.parse(saved));
    const agent = new URLSearchParams(window.location.search).get("agent");
    if (agent) {
      document.getElementById("agentName").textContent = "ğŸ‘¤ Ù…ÙˆØ²Ø¹: " + agent;
    }
  };

  function logout() {
    window.location.href = "login.html";
  }

  function saveToLocal() {
    localStorage.setItem("posti_clients", JSON.stringify(clients));
  }

  function processTracking() {
    const input = document.getElementById("tracking");
    const value = input.value.toUpperCase();
    const select = document.getElementById("messageType");

    if (value.startsWith("CH") && value.length === 12)
      input.value = "00779999900" + value.slice(2), select.value = "ØµÙƒ Ø¨Ø±ÙŠØ¯ÙŠ";
    else if (value.startsWith("LR")) select.value = "Ø±Ø³Ø§Ù„Ø©";
    else if (value.startsWith("LE")) select.value = "Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø±Ø¬";
    else if (value.startsWith("TG")) select.value = "ØªÙ„ØºØ±Ø§Ù…";
  }

  function saveClient() {
    const name = document.getElementById("name").value.trim();
    const surname = document.getElementById("surname").value.trim();
    const address = document.getElementById("address").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const tracking = document.getElementById("tracking").value.trim();
    const type = document.getElementById("messageType").value;
    const status = document.getElementById("deliveryStatus").value;
    const image = document.getElementById("idImage").files[0];

    if (!phone.match(/^0[567]/)) {
      alert("ğŸ“µ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05 Ø£Ùˆ 06 Ø£Ùˆ 07");
      return;
    }

    const now = new Date();
    const date = now.toLocaleDateString('ar-DZ');
    const time = now.toLocaleTimeString('ar-DZ');

    const entry = {
      Ø§Ù„Ø§Ø³Ù…: name, Ø§Ù„Ù„Ù‚Ø¨: surname, Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: address, Ø§Ù„Ù‡Ø§ØªÙ: phone,
      Ø§Ù„ØªØªØ¨Ø¹: tracking, Ø§Ù„Ù†ÙˆØ¹: type, Ø§Ù„Ø­Ø§Ù„Ø©: status,
      Ø§Ù„ØªØ§Ø±ÙŠØ®: date, Ø§Ù„ÙˆÙ‚Øª: time, Ø§Ù„Ù‡ÙˆÙŠØ©: ""
    };

    if (image) {
      const reader = new FileReader();
      reader.onload = () => {
        entry.Ø§Ù„Ù‡ÙˆÙŠØ© = reader.result;
        clients.push(entry);
        saveToLocal();
        alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø²Ø¨ÙˆÙ†");
      };
      reader.readAsDataURL(image);
    } else {
      clients.push(entry);
      saveToLocal();
      alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø²Ø¨ÙˆÙ† Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø© Ø§Ù„Ù‡ÙˆÙŠØ©");
    }

    document.querySelectorAll("input, select").forEach(e => e.value = "");
  }

  function searchClients() {
    const q = document.getElementById("searchBox").value.trim();
    searchResults = clients.filter(c =>
      c.Ø§Ù„Ø§Ø³Ù….includes(q) || c.Ø§Ù„Ù„Ù‚Ø¨.includes(q) ||
      c.Ø§Ù„Ù‡Ø§ØªÙ.includes(q) || c.Ø§Ù„ØªØªØ¨Ø¹.includes(q)
    );
    const resultsDiv = document.getElementById("results");
    if (!searchResults.length) {
      resultsDiv.innerHTML = "<b>âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬.</b>";
      return;
    }
    resultsDiv.innerHTML = searchResults.map(c => `
      <div class="result-card">
        <b>Ø§Ù„Ø§Ø³Ù…:</b> ${c.Ø§Ù„Ø§Ø³Ù…}<br>
        <b>Ø§Ù„Ù„Ù‚Ø¨:</b> ${c.Ø§Ù„Ù„Ù‚Ø¨}<br>
        <b>Ø§Ù„Ù‡Ø§ØªÙ:</b> ${c.Ø§Ù„Ù‡Ø§ØªÙ}<br>
        <b>Ø§Ù„ØªØªØ¨Ø¹:</b> ${c.Ø§Ù„ØªØªØ¨Ø¹}<br>
        <b>Ø§Ù„Ù†ÙˆØ¹:</b> ${c.Ø§Ù„Ù†ÙˆØ¹}<br>
        <b>Ø§Ù„Ø­Ø§Ù„Ø©:</b> ${c.Ø§Ù„Ø­Ø§Ù„Ø©}<br>
        <b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> ${c.Ø§Ù„ØªØ§Ø±ÙŠØ®}<br>
        <b>Ø§Ù„ÙˆÙ‚Øª:</b> ${c.Ø§Ù„ÙˆÙ‚Øª}<br>
        ${c.Ø§Ù„Ù‡ÙˆÙŠØ© ? `<img src="${c.Ø§Ù„Ù‡ÙˆÙŠØ©}" width="150">` : ""}
      </div>`).join("");
  }

  function downloadExcel() {
    if (!clients.length) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª!");
    exportToExcel(clients, "ÙƒÙ„_Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†.xlsx");
  }

  function downloadSearchExcel() {
    if (!searchResults.length) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬!");
    exportToExcel(searchResults, "Ù†ØªØ§Ø¦Ø¬_Ø§Ù„Ø¨Ø­Ø«.xlsx");
  }

  function exportToExcel(dataArray, filename) {
    const headers = ["Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„Ù„Ù‚Ø¨", "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†", "Ø§Ù„Ù‡Ø§ØªÙ", "Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹", "Ø§Ù„Ù†ÙˆØ¹", "Ø§Ù„Ø­Ø§Ù„Ø©", "Ø§Ù„ØªØ§Ø±ÙŠØ®", "Ø§Ù„ÙˆÙ‚Øª", "Ø±Ø§Ø¨Ø· Ø§Ù„Ù‡ÙˆÙŠØ©"];
    const rows = dataArray.map(c => [
      c.Ø§Ù„Ø§Ø³Ù…, c.Ø§Ù„Ù„Ù‚Ø¨, c.Ø§Ù„Ø¹Ù†ÙˆØ§Ù†, c.Ø§Ù„Ù‡Ø§ØªÙ,
      c.Ø§Ù„ØªØªØ¨Ø¹, c.Ø§Ù„Ù†ÙˆØ¹, c.Ø§Ù„Ø­Ø§Ù„Ø©, c.Ø§Ù„ØªØ§Ø±ÙŠØ®, c.Ø§Ù„ÙˆÙ‚Øª, c.Ø§Ù„Ù‡ÙˆÙŠØ©
    ]);
    const ws = XLSX.utils.aoa_to_sheet([headers, ...rows]);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "PostiDZ");
    XLSX.writeFile(wb, filename);
  }
</script>

</body>
</html>
